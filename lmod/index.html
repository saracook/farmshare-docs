<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Lmod - FarmShare</title>
  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../style.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Lmod";
    var mkdocs_page_input_path = "lmod.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> FarmShare</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../connecting/">Getting Connected</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../slurm/">Running Jobs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../software/">Using Software</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../capacity/">Adding Capacity</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">FarmShare</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Lmod</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="environment-modules">Environment modules<a class="headerlink" href="#environment-modules" title="Permanent link">&para;</a></h2>
<p>Software is provided on Sherlock under the form of loadable <em>environment
modules</em>.</p>
<p>!!! tldr &ldquo;Software is only accessible via modules&rdquo;</p>
<pre><code>The use of a module system means that most software is not accessible by
default and has to be loaded using the `module` command. This mechanism
allows us to provide multiple versions of the same software concurrently,
and gives users the possibility to easily switch between software versions.
</code></pre>
<p>Sherlock uses <a href="//lmod.readthedocs.io">Lmod</a> to manage software installations. The modules
system helps setting up the user&rsquo;s shell environment to give access to
applications, and make running and compiling software easier. It also allows us
to provide multiple versions of the same software, that would otherwise
conflict with each other, and abstract things from the OS sometimes rigid
versions and dependencies.</p>
<p>When you first log into Sherlock, you&rsquo;ll be presented with a default, bare bone
environment with minimal software available. The module system is used to
manage the user environment and to <em>activate</em> software packages on demand.
In order to use software installed on Sherlock, you must first load the
corresponding software module.</p>
<p>When you load a module, the system will set or modify your user environment
variables to enable access to the software package provided by that module. For
instance, the <code>$PATH</code> environment variable might be updated so that appropriate
executables for that package can be used.</p>
<h2 id="module-categories">Module categories<a class="headerlink" href="#module-categories" title="Permanent link">&para;</a></h2>
<p>Modules on Sherlock are organized by scientific field, in distinct categories.
This is to limit the information overload that can result when displaying the
full list of available modules. Given the large diversity of the Sherlock user
population,  all users are not be interested in the same kind of software, and
high-energy physicists may not want to see their screens cluttered with the
latest bioinformatics packages.</p>
<p>!!! summary &ldquo;Module categories&rdquo;</p>
<pre><code>You will first have to load a category module before getting access to
individual modules. The `math` and `devel` categories are loaded by
default, and modules in those categories can be loaded directly
</code></pre>
<p>For instance, to be able to load the <code>gromacs</code> module, you&rsquo;ll first need to
load the <code>chemistry</code> module. This can be done in a single command, by
specifying first the category, then the actual application module name:</p>
<pre><code class="language-shell">$ module load chemistry gromacs
</code></pre>
<p>The <code>math</code> and <code>devel</code> categories, which are loaded by default, provide direct
access to compilers, languages, and MPI and numerical libraries.</p>
<p>For a complete list of software module categories, please refer to the <a href="list.md">list of
available software</a></p>
<p>!!! tip &ldquo;Searching for a module&rdquo;</p>
<pre><code>To know how to access a module, you can use the `module spider
&lt;module_name&gt;` command. It will search through all the installed modules,
even if they're masked, and display instructions to load them. See the
[Examples](#examples) section for details.
</code></pre>
<h2 id="module-usage">Module usage<a class="headerlink" href="#module-usage" title="Permanent link">&para;</a></h2>
<p>The most common <code>module</code> commands are outlined in the following table.
<code>module</code> commands may be shortened with the <code>ml</code> alias, with slightly different
semantics.</p>
<p>!!! tip &ldquo;Module names auto-completion&rdquo;</p>
<pre><code>The `module` command supports auto-completion, so you can just start typing
the name of a module, and press ++tab++ to let the shell automatically
complete the module name and/or version.
</code></pre>
<table>
<thead>
<tr>
<th>Module\ command</th>
<th>Short\ version</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>module avail</code></td>
<td><code>ml av</code></td>
<td>List\ available\ software[^missing_mod]</td>
</tr>
<tr>
<td><code>module spider gromacs</code></td>
<td><code>ml spider gromacs</code></td>
<td>Search for particular software</td>
</tr>
<tr>
<td><code>module keyword blas</code></td>
<td><code>ml key blas</code></td>
<td>Search for <code>blas</code> in module names and descriptions</td>
</tr>
<tr>
<td><code>module whatis gcc</code></td>
<td><code>ml whatis gcc</code></td>
<td>Display information about the <code>gcc</code> module</td>
</tr>
<tr>
<td><code>module help gcc</code></td>
<td><code>ml help gcc</code></td>
<td>Display module specific help</td>
</tr>
<tr>
<td><code>module load gcc</code></td>
<td><code>ml gcc</code></td>
<td>Load a module to use the associated software</td>
</tr>
<tr>
<td><code>module load gsl/2.3</code></td>
<td><code>ml gsl/2.3</code></td>
<td>Load specific version of a module</td>
</tr>
<tr>
<td><code>module unload gcc</code></td>
<td><code>ml -gcc</code></td>
<td>Unload a module</td>
</tr>
<tr>
<td><code>module swap gcc icc</code></td>
<td><code>ml -gcc icc</code></td>
<td>Swap a module (unload <code>gcc</code> and replace it with <code>icc</code>)</td>
</tr>
<tr>
<td><code>module purge</code></td>
<td><code>ml purge</code></td>
<td>Remove all modules[^sticky_mod]</td>
</tr>
<tr>
<td><code>module save foo</code></td>
<td><code>ml save foo</code></td>
<td>Save the state of all loaded modules in a collection named <code>foo</code></td>
</tr>
<tr>
<td><code>module restore foo</code></td>
<td><code>ml restore foo</code></td>
<td>Restore the state of saved modules from the <code>foo</code> collection</td>
</tr>
</tbody>
</table>
<p>Additional module sub-commands are documented in the <code>module help</code> command. For
complete reference, please refer to the <a href="//lmod.readthedocs.io/en/latest/010_user.html">official Lmod
documentation</a>.</p>
<h3 id="module-properties">Module properties<a class="headerlink" href="#module-properties" title="Permanent link">&para;</a></h3>
<p>!!! important &ldquo;Multiple versions&rdquo;</p>
<pre><code>When multiple versions of the same module exist, `module` will load the one
marked as `Default (D)`. For the sake of reproducibility, we recommend
always specifying the module version you want to load, as defaults may
evolve over time.
</code></pre>
<p>To quickly see some of the modules characteristics, <code>module avail</code> will display
colored property attributes next to the module names. The main module
properties are:</p>
<ul>
<li><code>S</code>: Module is sticky, requires <code>--force</code> to unload or purge</li>
<li><code>L</code>: Indicate currently loaded module</li>
<li><code>D</code>: Default module that will be loaded when multiple versions are available</li>
<li><code>r</code>: Restricted access, typically software under license.  [Contact
  us][url_contact] for details</li>
<li><code>g</code>: GPU-accelerated software, will only run on GPU nodes</li>
<li><code>m</code>: Software supports parallel execution using MPI</li>
</ul>
<h3 id="searching-for-modules">Searching for modules<a class="headerlink" href="#searching-for-modules" title="Permanent link">&para;</a></h3>
<p>You can search through all the available modules for either:</p>
<ul>
<li>a module name (if you already know it), using <code>module spider</code></li>
<li>any string within modules names and descriptions, using <code>module keyword</code></li>
</ul>
<p>For instance, if you want to know how to load the <code>gromacs</code> module, you can do:</p>
<pre><code class="language-shell">$ module spider gromacs
</code></pre>
<p>If you don&rsquo;t know the module name, or want to list all the modules that contain
a specific string of characters in their name or description, you can use
<code>module keyword</code>. For instance, the following command will list all the modules
providing a BLAS library:</p>
<pre><code class="language-shell">$ module keyword blas
</code></pre>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<h4 id="listing">Listing<a class="headerlink" href="#listing" title="Permanent link">&para;</a></h4>
<p>To list all the modules that can be loaded, you can do:</p>
<pre><code class="language-shell">$ ml av

-- math -- numerical libraries, statistics, deep-learning, computer science ---
   R/3.4.0             gsl/1.16             openblas/0.2.19
   cudnn/5.1  (g)      gsl/2.3       (D)    py-scipystack/1.0_py27 (D)
   cudnn/6.0  (g,D)    imkl/2017.u2         py-scipystack/1.0_py36
   fftw/3.3.6          matlab/R2017a (r)

------------------ devel -- compilers, MPI, languages, libs -------------------
   boost/1.64.0          icc/2017.u2           python/2.7.13    (D)
   cmake/3.8.1           ifort/2017.u2         python/3.6.1
   cuda/8.0.61    (g)    impi/2017.u2   (m)    scons/2.5.1_py27 (D)
   eigen/3.3.3           java/1.8.0_131        scons/2.5.1_py36
   gcc/6.3.0      (D)    julia/0.5.1           sqlite/3.18.0
   gcc/7.1.0             llvm/4.0.0            tbb/2017.u2
   h5utils/1.12.1        nccl/1.3.4     (g)    tcltk/8.6.6
   hdf5/1.10.0p1         openmpi/2.0.2  (m)

-------------- categories -- load to make more modules available --------------
   biology      devel (S,L)    physics    system
   chemistry    math  (S,L)    staging    viz

  Where:
   S:  Module is Sticky, requires --force to unload or purge
   r:  Restricted access
   g:  GPU support
   L:  Module is loaded
   m:  MPI support
   D:  Default Module

Use &quot;module spider&quot; to find all possible modules.
Use &quot;module keyword key1 key2 ...&quot; to search for all possible modules matching
any of the &quot;keys&quot;.
</code></pre>
<h4 id="searching">Searching<a class="headerlink" href="#searching" title="Permanent link">&para;</a></h4>
<p>To search for a specific string in modules names and descriptions, you can run:</p>
<pre><code class="language-shell">$ module keyword numpy
---------------------------------------------------------------------------

The following modules match your search criteria: &quot;numpy&quot;
---------------------------------------------------------------------------

  py-scipystack: py-scipystack/1.0_py27, py-scipystack/1.0_py36
    The SciPy Stack is a collection of open source software for scientific
    computing in Python. It provides the following packages: numpy, scipy,
    matplotlib, ipython, jupyter, pandas, sympy and nose.

---------------------------------------------------------------------------
[...]
$ ml key compiler
---------------------------------------------------------------------------

The following modules match your search criteria: &quot;compiler&quot;
---------------------------------------------------------------------------

  cmake: cmake/3.8.1
    CMake is an extensible, open-source system that manages the build
    process in an operating system and in a compiler-independent manner.

  gcc: gcc/6.3.0, gcc/7.1.0
    The GNU Compiler Collection includes front ends for C, C++, Fortran,
    Java, and Go, as well as libraries for these languages (libstdc++,
    libgcj,...).

  icc: icc/2017.u2
    Intel C++ Compiler, also known as icc or icl, is a group of C and C++
    compilers from Intel

  ifort: ifort/2017.u2
    Intel Fortran Compiler, also known as ifort, is a group of Fortran
    compilers from Intel

  llvm: llvm/4.0.0
    The LLVM Project is a collection of modular and reusable compiler and
    toolchain technologies. Clang is an LLVM native C/C++/Objective-C
    compiler,

---------------------------------------------------------------------------
</code></pre>
<p>To get information about a specific module, especially how to load it, the
following command can be used:</p>
<pre><code class="language-shell">$ module spider gromacs

-------------------------------------------------------------------------------
  gromacs: gromacs/2016.3
-------------------------------------------------------------------------------
    Description:
      GROMACS is a versatile package to perform molecular dynamics, i.e.
      simulate the Newtonian equations of motion for systems with hundreds to
      millions of particles.

    Properties:
      GPU support      MPI support

    You will need to load all module(s) on any one of the lines below before
    the &quot;gromacs/2016.3&quot; module is available to load.

      chemistry
</code></pre>
<h4 id="loading">Loading<a class="headerlink" href="#loading" title="Permanent link">&para;</a></h4>
<p>Loading a category module allows to get access to field-specific software:</p>
<pre><code class="language-shell">$ ml chemistry
$ ml av

------------- chemistry -- quantum chemistry, molecular dynamics --------------
   gromacs/2016.3 (g,m)    vasp/5.4.1 (g,r,m)

-- math -- numerical libraries, statistics, deep-learning, computer science ---
   R/3.4.0             gsl/1.16             openblas/0.2.19
   cudnn/5.1  (g)      gsl/2.3       (D)    py-scipystack/1.0_py27 (D)
   cudnn/6.0  (g,D)    imkl/2017.u2         py-scipystack/1.0_py36
   fftw/3.3.6          matlab/R2017a (r)

------------------ devel -- compilers, MPI, languages, libs -------------------
   boost/1.64.0          icc/2017.u2           python/2.7.13    (D)
   cmake/3.8.1           ifort/2017.u2         python/3.6.1
   cuda/8.0.61    (g)    impi/2017.u2   (m)    scons/2.5.1_py27 (D)
   eigen/3.3.3           java/1.8.0_131        scons/2.5.1_py36
   gcc/6.3.0      (D)    julia/0.5.1           sqlite/3.18.0
   gcc/7.1.0             llvm/4.0.0            tbb/2017.u2
   h5utils/1.12.1        nccl/1.3.4     (g)    tcltk/8.6.6
   hdf5/1.10.0p1         openmpi/2.0.2  (m)

-------------- categories -- load to make more modules available --------------
   biology          devel (S,L)    physics    system
   chemistry (L)    math  (S,L)    staging    viz

[...]
</code></pre>
<h3 id="resetting-the-modules-environment">Resetting the modules environment<a class="headerlink" href="#resetting-the-modules-environment" title="Permanent link">&para;</a></h3>
<p>If you want to reset your modules environment as it was when you initially
connected to Sherlock, you can use the <code>ml reset</code> command: it will remove all
the modules you have loaded, and restore the original state where only the
<code>math</code> and <code>devel</code> categories are accessible.</p>
<p>If you want to remove <em>all</em> modules from your environment, including the
default <code>math</code> and <code>devel</code> modules, you can use <code>ml --force purge</code>.</p>
<h3 id="loading-modules-in-jobs">Loading modules in jobs<a class="headerlink" href="#loading-modules-in-jobs" title="Permanent link">&para;</a></h3>
<p>In order for an application running in a Slurm job to have access to any
necessary module-provided software packages, we recommend loading those modules
in the job script directly. Since Slurm propagates all user environment
variables by default, this is not strictly necessary, as jobs will inherit the
modules loaded at submission time. But to make sure things are reproducible and
avoid issues, it is preferable to explicitly load the modules in the batch
scripts.</p>
<p><code>module load</code> commands should be placed right after <code>#SBATCH</code> directives and
before the actual executable calls. For instance:</p>
<pre><code class="language-shell">#!/bin/bash
#SBATCH ...
#SBATCH ...
#SBATCH ...

ml reset
ml load gromacs/2016.3

srun gmx_mpi ...
</code></pre>
<h2 id="custom-modules">Custom modules<a class="headerlink" href="#custom-modules" title="Permanent link">&para;</a></h2>
<p>Users are welcome and encouraged to build and install their own software on
Sherlock. To that end, and to facilitate usage or sharing of their custom
software installations, they can create their own module repositories.</p>
<p>See the <a href="install.md">Software Installation page</a> for more details.</p>
<h3 id="contributed-software">Contributed software<a class="headerlink" href="#contributed-software" title="Permanent link">&para;</a></h3>
<p>PI groups, labs or departments can share their software installations and
modules with the whole Sherlock community of users, and let everyone benefit
from their tuning efforts and software developments.</p>
<p>Those modules are available in the specific <code>contribs</code> category, and organized
by contributor name.</p>
<p>For instance, listing the available contributed modules can be done with:</p>
<pre><code class="language-shell">$ ml contribs
$ ml av
-------------------- contribs -- contributed software ----------------------
   poldrack
</code></pre>
<p>To get information about a specific lab module:</p>
<pre><code class="language-shell">$ ml show poldrack
----------------------------------------------------------------------------
   /share/software/modules/contribs/poldrack.lua:
----------------------------------------------------------------------------
prepend_path(&quot;MODULEPATH&quot;,&quot;/home/groups/russpold/modules&quot;)
whatis(&quot;Name:        poldrack&quot;)
whatis(&quot;Version:     1.0&quot;)
whatis(&quot;Category:    contribs&quot;)
whatis(&quot;URL:         https://github.com/poldracklab/lmod_modules&quot;)
whatis(&quot;Description: Software modules contributed by the Poldrack Lab.&quot;)
</code></pre>
<p>And to list the available software modules contributed by the lab:</p>
<pre><code class="language-shell">$ ml poldrack
$ ml av

------------------------ /home/groups/russpold/modules -------------------------
   afni/17.3.03           freesurfer/6.0.1            gsl/2.3      (D)
   anaconda/5.0.0-py36    fsl/5.0.9                   pigz/2.4
   ants/2.1.0.post710     fsl/5.0.11           (D)    remora/1.8.2
   c3d/1.1.0              git-annex/6.20171109        xft/2.3.2
[...]
</code></pre>
<p>[url_contact]:      mailto:{{ support_email }}</p>
<p>[^missing_mod]: If a module is not listed here, it might be unavailable in the
  loaded modules categories, and require loading another category module.
  Search for not-listed software using the <code>module spider</code> command.</p>
<p>[^sticky_mod]: The <code>math</code> and <code>devel</code> category modules will not be unloaded
  with <code>module purge</code> as they are &ldquo;sticky&rdquo;. If a user wants to unload a sticky
  module, they must specify the <code>--force</code> option.</p>
<p>&ndash;8&lt;&mdash; &ldquo;includes/_acronyms.md&rdquo;</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
